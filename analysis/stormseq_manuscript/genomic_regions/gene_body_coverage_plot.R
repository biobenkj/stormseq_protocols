## plot gene body coverage
## this is for protein coding only
## 750k raw, sub-sampled reads

library(ggplot2)

## import data
## pull directly from RSeQC .r files
storm_gb <- c(0.261282020041914,0.49772798004673724,0.6279251849926573,0.7104786559727714,0.7681617047763453,0.8177096347437945,0.8435639281322914,0.8713327732356905,0.8908230101124325,0.9048299752710275,0.9225667231549904,0.9336116405120838,0.9417793170830748,0.9526337520781053,0.9557359942704663,0.9548849429262908,0.9573778455362207,0.9515484419476367,0.9555346070285324,0.9637491196663075,0.9636328532492658,0.9695739730172477,0.977139684528886,0.9814421695784135,0.9905732412919631,0.9927120098893923,0.9906352971191426,0.9933400995890116,1.0,0.9953913937903535,0.9853631407372029,0.9798575885450749,0.9767971614676149,0.9788248415046318,0.9741635153002133,0.975663524675272,0.9675986207131367,0.9673213700263451,0.9752270941233132,0.9785422560564644,0.9769147615750005,0.9755589476618329,0.9764838226891638,0.9689004593935616,0.9625470724045582,0.9578327908482482,0.9572862916167285,0.9407226420688142,0.9348410676520703,0.9384090815839565,0.9279762496423553,0.9088800790360588,0.9024629887200394,0.8933843231917689,0.8849302954586981,0.8753766792632413,0.8636521289973543,0.8540508137590086,0.8481542549389888,0.840888466849989,0.8245052577603714,0.8124586605026114,0.8062179311214838,0.7949200833132822,0.7831516781707919,0.7841093462901089,0.7687536279319319,0.7569647467200435,0.7474568682581463,0.7389092468438806,0.7208864616073306,0.705156211619628,0.6920753767263347,0.680292693251927,0.6649350135844206,0.6568224105793967,0.6429233174339138,0.624533139733797,0.6118306806363146,0.5992727308102161,0.5876970831486107,0.5646173363897332,0.5474760420181496,0.5290988874119794,0.5037819927797142,0.48842164573152014,0.4673020315163581,0.4422909442347195,0.41719089196190323,0.394633324198862,0.3706680070516131,0.3415220874419168,0.31735357864815106,0.2929922339211273,0.2598552851833985,0.2265597057471149,0.19027077601243375,0.149729727651802,0.09152504901900407,0.0)

vasa_gb <- c(0.0309621336021253,0.3175684318766631,0.529875656264703,0.6681050550567862,0.7699926378670566,0.860558951140362,0.9035991551938722,0.9386307750333107,0.9512240849900877,0.9726277983379477,0.9934199221184057,0.9960309813487143,1.0,0.998567376143505,0.9820289291747438,0.9626167249433566,0.9467123766732931,0.9443491923888392,0.9389739020347706,0.9403867617759815,0.9388242986621341,0.9415479035489214,0.946569910342287,0.9463785827262731,0.9496682099146684,0.9550025995301631,0.9554659582329343,0.9566537266611876,0.9571283399296068,0.9570396759124296,0.957784398756398,0.9608744632807443,0.9677721395148898,0.968014524428721,0.9678481764584133,0.982814278255685,0.9794554766637954,0.9875362547989742,0.9858368153861441,0.9939562982470876,0.9922714074191195,0.9934468232753202,0.9919892197731189,0.9835897452789842,0.9795002204247857,0.9786929112157511,0.9834030841901901,0.9688627343763296,0.9712517218112934,0.9759723258465767,0.959076477793095,0.9437101526613205,0.9379253059183095,0.9243451627053341,0.9227914836427241,0.9234791101536495,0.9211137298563863,0.9244884525411436,0.9330712941048586,0.9245128831836477,0.9146525111680976,0.9095901526393604,0.9134633702318385,0.9097932838242245,0.8893256209363469,0.8833983078623298,0.8660415716204872,0.8509159843929369,0.844334808504938,0.8421322076571672,0.8287373530249802,0.8132617762559409,0.8042345165999353,0.7952336090976418,0.7729509416228425,0.7571566684948473,0.7455389372286209,0.7327081833868337,0.7187689920795308,0.7002758192088534,0.6907643387283878,0.6746219975701119,0.6479618530614889,0.6232830611100955,0.5917634147559983,0.5672624998421616,0.5339994938190474,0.5028861098346786,0.4685119213300371,0.43593187529062855,0.39730922550471237,0.35765170468239343,0.32599453302611114,0.27837893628433535,0.23610486619968454,0.18415873219788492,0.13919921294900914,0.08607244756058662,0.044464318360368994,0.0)

# sstotal no umi
# sstotal_gb <- c(0.7981901112903609,0.963445126270681,1.0,0.9738677429983453,0.93632780488318,0.8937044304996533,0.8273350874565144,0.7627682259647851,0.7053837877686999,0.6475734379744184,0.5848269184895928,0.5259542551001188,0.46562930657493773,0.40871154126198034,0.35124240286898084,0.31627590437183406,0.28595794553043197,0.27002641922959636,0.2535657632380765,0.24854379761715226,0.23468780964742914,0.226903171238925,0.2247573963926482,0.21719617803784158,0.21443175207671625,0.2126693743701587,0.21473088731290763,0.22052523545394648,0.2210778138408011,0.2201226629785739,0.22135021318042447,0.2217766726453537,0.2264169943001041,0.2293875277261657,0.23889476871641507,0.25546346402767295,0.25803854724589037,0.2648643092983832,0.2715330527452123,0.28100895575833684,0.28373360659464997,0.28574230518434235,0.29417890500505844,0.3018542987870121,0.31318670301141527,0.31639774993324243,0.33402130785212464,0.3438355733595199,0.3546942920066134,0.36921254128312797,0.37453944952761287,0.37490958829239474,0.38545865266202417,0.3856942353571932,0.39872787536075655,0.4074504616160732,0.41155529832603704,0.41816794021941184,0.4227267393042991,0.42609436653840377,0.4297103965492285,0.4325926138579384,0.4372471800477455,0.4461419060305554,0.4484240996933371,0.4603770177794808,0.4590050499068243,0.4626543902150125,0.4658189780378854,0.4715284068353168,0.4756912078456269,0.4782909450668271,0.4809092001836011,0.49087423861590457,0.4905126465721567,0.49576186731390914,0.49862085507314186,0.49982999695276525,0.5022406105777507,0.50876088213995,0.5215883051052304,0.5248680545153697,0.5249889139166587,0.528783438909079,0.5275890894312453,0.5289136120448282,0.5183556722341249,0.5037328899849632,0.4846685521317659,0.47060700456383947,0.4439309350430574,0.4077739221352076,0.3737885433834299,0.32896723724064947,0.27976858547493527,0.2211239442197156,0.16557869464614766,0.1115158628785992,0.07134452084506909,0.0)

# sstotal umi
sstotal_gb <- c(0.4683584365819932,0.6418119369823849,0.730633043677741,0.8091862809029098,0.8150657725647795,0.8823889258245201,0.9281992569919858,0.9508760824913072,0.965430373267005,1.0,0.9682363011880056,0.9350664522747982,0.9402959712312735,0.9294970783089664,0.9117014203815297,0.9085620097325978,0.879984451633322,0.8949019624502697,0.8730259203167449,0.8652793501972221,0.8447393630692306,0.8408352786492462,0.8388343822816591,0.8413875430394508,0.8117585585049778,0.7824205748222665,0.7755321386013692,0.7654703062306044,0.7571693476270686,0.7489427323068296,0.7422072308401428,0.7258920662972159,0.6956131090573484,0.6502913194658329,0.6768892221356064,0.6686010080949215,0.6628935680315385,0.6488490597698757,0.6589257607972998,0.6676366695058721,0.6882701167614367,0.684697390975575,0.7014671115935164,0.7003222250307463,0.7242331490327939,0.7163612573785708,0.6861693879848509,0.6934507815603168,0.6995002007268649,0.7005303862239772,0.7143709814800261,0.695101202449505,0.7086486727599838,0.7039183158485012,0.7358455698837484,0.7440488201720941,0.7327528892986029,0.7254417584098184,0.7436409941608662,0.7305247148935086,0.7367334410956925,0.7210724974457772,0.7283326500831583,0.7213401332656455,0.7204034078961064,0.7171153106805809,0.7298917349385818,0.7405100798871681,0.7359177890732367,0.7397666470542005,0.742540713568074,0.7176357136636582,0.7204947439298709,0.730335670544554,0.7351063852383977,0.7163867465042726,0.7018536966666595,0.6985146211997306,0.6869659231630306,0.6827453487655829,0.6809865990921623,0.6628659548120284,0.6457861164980491,0.6376232239920644,0.6509455403588444,0.6428293779166463,0.6198806684098397,0.6033913281746175,0.5879045602169974,0.5732971670960876,0.5431732687042391,0.5167644103834201,0.5106448961211923,0.4804551508212809,0.43351055356008744,0.35460046857509414,0.29018095155154433,0.215718719001506,0.11294444007825162,0.0)

ss3_ir_gb <- c(0.0,0.08676412432617617,0.1346182427896276,0.17039346777978492,0.20856542504929224,0.2483419727849833,0.27561160787982414,0.3054134708923333,0.33035027022977015,0.36091521526738246,0.3892611128743439,0.4116280466168017,0.43367777351606457,0.45963149037674617,0.48263966510519907,0.5025494712256455,0.5238837321380774,0.5446434495298879,0.5664797795517476,0.5888395358766717,0.6078371097344863,0.6265507379523108,0.64891277004377,0.6695270134363007,0.6897612038174759,0.7058608515813339,0.7222645767660693,0.7419693888393958,0.7584553917373219,0.7730202975617262,0.7816993708906003,0.796246070582724,0.8093170232063415,0.8232098776670452,0.8334336712963344,0.8516229979162732,0.8490848179938207,0.8671363732089061,0.8763241678878488,0.8868441612846247,0.8977785192497463,0.9076234852804296,0.9145819040498316,0.9219937255366039,0.9270567809002267,0.9334770684135684,0.9464160265781522,0.9478466084338858,0.9513495383082406,0.9626089807699478,0.9720803709709523,0.9647795368675054,0.9735113029446143,0.9756785329218514,0.9794965689318305,0.9841309048920402,0.9871245882394337,0.990199849064161,0.9928481410751177,0.9913979526153897,0.9901797172832739,0.9893940526517845,0.9940122831872845,0.9957171824399753,0.9908382891067283,1.0,0.9958407740687257,0.9953064941098786,0.9917534973717522,0.990976235570546,0.9886985433868762,0.9855889710051589,0.9866729361117058,0.9818157500900241,0.9773739789904735,0.9724630498667713,0.965378763702084,0.9582880003557198,0.9508339896585667,0.9459102812304755,0.938059236802436,0.9255265904938431,0.9104571647345117,0.8978096797453803,0.8810980258425544,0.8667773272732588,0.8433414834951782,0.8214752183904344,0.7980420004968174,0.7738513024649527,0.7441355684628475,0.7096011614111923,0.6846325013422646,0.6548801800166341,0.6184833206444761,0.575554486139794,0.5218540985067295,0.4584374131816949,0.3903154930159351,0.3187750213965819)

# using r1 and r2 or 5' UMI reads
#ss3_5p_gb <- c(0.854115448965058,0.9865365481326913,1.0,0.9565002778848475,0.9125488696874482,0.8708731077513774,0.8114123213182032,0.7595329484429972,0.7118681733733354,0.6645340477604479,0.6220499950915115,0.5808930084855742,0.5411230805805605,0.49767612307466674,0.4612754421680827,0.4401393721629166,0.42787623301955363,0.4195223403252902,0.41219154223396287,0.4101493612985324,0.4059571046725,0.401978469148211,0.40379349285548793,0.4026345770229905,0.4035550336188755,0.4033069151075918,0.4007086359303728,0.400339283665562,0.39682659315279645,0.3940923613273131,0.394689067948332,0.39336495880615047,0.39117710023843294,0.3893335586726028,0.3884588357853654,0.3899745533965361,0.3804664102337321,0.3802734218683613,0.3750691755197971,0.3735181719868681,0.3658494307007495,0.3582998204689098,0.35595800489061563,0.35134336855310766,0.34861196222973906,0.34445394017584086,0.34433908022940973,0.33593432849708127,0.3364142696004753,0.33446743293407893,0.3283446355608234,0.3220684068518032,0.31925670370089526,0.31276153143265967,0.30861389145629925,0.3044917467083229,0.2984318331844579,0.29141893693571275,0.2872521755380643,0.2797509273889325,0.2735795708049146,0.26858355739127043,0.2656670478247116,0.2619691226500529,0.2546668424172788,0.25249659395576474,0.24801298206515818,0.24330852104414263,0.2396385880532251,0.2356637636713234,0.23209200045155468,0.22509664859966144,0.22195915848399064,0.21796527839015242,0.2123241962727816,0.2101147850377704,0.20546072308935934,0.19941060025886856,0.1955486645428528,0.18830985954363277,0.1849770812352885,0.1781357521033235,0.16842187296095668,0.16223415474841402,0.15402613681449212,0.1478495234823538,0.14149004102497653,0.13150688496014137,0.12424817002741526,0.11606012773635095,0.10611705437593398,0.09418173918723052,0.08701462309050267,0.07744780147680454,0.0688457245619059,0.057216680660568224,0.04401422633743828,0.03020152926687945,0.015533953533237827,0.0)

# adjusted to use r1 only as (speculated) the fragment lengths are long due to randomness of Tn5 and r1 is the most relevant for UMI counting
ss3_5p_gb <- c(0.8817160114725245,1.0,0.9974345251091956,0.9371394723342856,0.8717739392593631,0.8090539305626286,0.7284570677489819,0.6552927627789649,0.58628862225629,0.5197826928190483,0.4591437854945511,0.4030030293419049,0.34736696791257066,0.28518803445463353,0.23498391135013405,0.2015371848707704,0.17656921856320434,0.156976735926562,0.1408982775462732,0.12941988519445818,0.11983815920768302,0.10838595588569107,0.10266439406830828,0.09431750554432261,0.09003183140688518,0.08616913480772218,0.0831125538411555,0.07859537856273492,0.07382885160177727,0.07119339517609188,0.07310426785447917,0.07103910225982298,0.06814237320170463,0.06446522340817487,0.06499802192528283,0.06323057124512468,0.05930252560456356,0.057798509387130374,0.059548665424952525,0.059057868182089114,0.05452135996420009,0.05014643311899301,0.04940696362597,0.04602005499078597,0.04599781902206827,0.04503728694004349,0.0454346313477128,0.044645069158495206,0.04600479864558244,0.04554500822576426,0.04356699527516548,0.04263431992061759,0.041391205736138734,0.04073370049447236,0.04114833954447765,0.03942869619706257,0.0379803316680034,0.03740028171737034,0.03658372753279265,0.035771002876160786,0.03499126157312684,0.03460972940987901,0.03443375642411034,0.033768221527073684,0.03154122749341645,0.030884895816765734,0.03208434102934623,0.029172170326285045,0.028258148478828116,0.02771417021078154,0.028412070795618402,0.02742744974748278,0.025710400596418093,0.024971054636554635,0.023500824738256397,0.02363448761688167,0.02372818751839486,0.024646471259856015,0.023545420208851336,0.021908049945691736,0.021967037029373405,0.021951780684169874,0.02056209440589352,0.019559128683565796,0.01779421043317829,0.016939608035461427,0.016035221774448834,0.01526437485890197,0.0157855612590129,0.014922867439345991,0.013003594506109795,0.010784444828083535,0.008979810666903027,0.007983145135711986,0.006365787244398312,0.00517622468458124,0.0034090828373219617,0.0026056849342355783,0.0014785683865673749,0.0)

tenx_gb <- c(0.0,0.024007942446522098,0.031007860976584305,0.03409711511863271,0.039841483928611934,0.044384714736435356,0.04964965913488053,0.055132035657257716,0.061242576270021706,0.06460947244390083,0.066464785860899,0.06824582339062311,0.07349589650553022,0.08141404968538779,0.08498667422936754,0.09060090588665264,0.09593800553807673,0.09977299817826776,0.10546405585267551,0.11288461159039385,0.11837439691106798,0.12518869283162526,0.13244249692071822,0.13985615388610934,0.14551236873374376,0.1491106019500977,0.15370467429406032,0.16014659756977995,0.164453578979736,0.16707868264586978,0.1704430823768445,0.17571726092968876,0.1801689823411561,0.18560210109224745,0.19179464851224753,0.2004539231130482,0.20468193102811438,0.21048924778014552,0.2175422090110583,0.2254256804249751,0.23393167880013974,0.24041601476176216,0.24795234639460628,0.253552807350709,0.2608193352455728,0.268001333046824,0.2791450246765328,0.28643976506056357,0.2958369130221844,0.3093705326590432,0.31815505890061757,0.32676598840818344,0.3402596918020439,0.34950697265898417,0.36106952982719115,0.37384613670762934,0.38615306335690236,0.40156186058010623,0.41526719790792715,0.42958180152178327,0.4432938497176268,0.4557568980005774,0.46754596038628293,0.4841294279481615,0.4974024243144949,0.5141375574936841,0.5277410506883942,0.5415884436705173,0.5580839720178278,0.5765057073919272,0.5937417129168506,0.610545833819312,0.6268499682106182,0.6454624801408638,0.6615049175227609,0.6805679971320434,0.6977565433983111,0.7144204876895166,0.7336343470815307,0.7533266376766116,0.7770543074310381,0.7995277964824583,0.823104632767209,0.8494583188658203,0.8766535478144649,0.906369861974893,0.9331463596023999,0.9588322606458191,0.9799698574651897,0.9969112021969772,1.0,0.9874251754992651,0.9623518424889482,0.9145159967632142,0.8420486078908265,0.7468065462101648,0.6311244153324007,0.5046141646828223,0.38678724038503737,0.29746888875139066)

tenx_gb_5p <- c(0.18098406897134534,0.28524626682277027,0.41639974476773295,0.5454760874661346,0.6582145640080084,0.7499601754821779,0.8171861964029175,0.8710994737333638,0.9111301101560877,0.9410620039841731,0.9640179443252963,0.9787145239752759,0.987589714130755,0.9959592203600369,1.0,0.9982446535203097,0.9927995495012788,0.9887233178506787,0.9794962727360657,0.9749271554183943,0.9654638422250603,0.9545711078495138,0.9428162955097489,0.9286503438983842,0.9135791306089828,0.8981450686280966,0.8795383570766488,0.8605881469131321,0.8425221271073124,0.8205586070874482,0.7987488466297714,0.778761630452683,0.758241912305329,0.737065554626579,0.71500524256671,0.6959291874821144,0.673336317928079,0.6520085882148744,0.6339293814826237,0.6123071668807483,0.5928666945544713,0.5727151970360009,0.5540119710640523,0.5352849392196516,0.5174908754797681,0.499744437365764,0.4839875177829173,0.46687488499612056,0.4513800382248742,0.43872063049388177,0.42477971725230873,0.40885851632808007,0.3978062340236916,0.3844788182426219,0.3729591079796618,0.3619317281447655,0.3494688472605229,0.3385154946663186,0.3278560856027525,0.31701582131342676,0.305298584773503,0.2945775719420406,0.2854985535468612,0.2767782889554855,0.2661450316491787,0.2582055441503294,0.2495337519243196,0.24005325408369962,0.23280923120385477,0.22630339858465134,0.21821133140650592,0.20948182208565316,0.20263834862591115,0.195877480849529,0.18869658864485148,0.181771703265616,0.17634481108603528,0.1685106940698586,0.16178165536958874,0.15411009845387036,0.14876350771576782,0.14136957030386343,0.13415110229934468,0.12872284978419526,0.12170555875311531,0.11544101912565181,0.1088075509395699,0.10149594159152155,0.09481533361369202,0.0890939565454406,0.08218535355010383,0.07413828849352663,0.06831948086041169,0.06065751569855008,0.052733685939715925,0.043398979981523866,0.033722385604384876,0.02323430941759759,0.012784919508666781,0.0)

ss2_gb <- c(0.0,0.2044337780327219,0.3281721210178456,0.4179654053962858,0.4970327598496767,0.5515481528033777,0.5844893689711459,0.621690588766244,0.6504941182425166,0.6952072850279852,0.7418690871360544,0.7749747984933928,0.7771891568145296,0.7746584615903732,0.8023780099456322,0.8091476196702504,0.8126737216825749,0.8358295829836053,0.8271788231423642,0.8398365170885195,0.8528906866197926,0.8516717350868239,0.8541138559781348,0.8930612554779007,0.873595991378765,0.8712087022173108,0.8847394860158,0.8899063220984524,0.8896321634491688,0.8805764923720628,0.8734905457444251,0.8822383155692588,0.8827318011379693,0.8856252293442547,0.8805005715153381,0.8924201460211144,0.8971651995664075,0.9047952456672389,0.9015601736056924,0.9222781318407856,0.9579145384222802,0.967160011641198,0.9780082585020815,0.9640556921662329,0.954738515915964,0.9647052372737663,1.0,0.967472130718844,0.995482709024881,0.9913618936348797,0.9765404552720708,0.9476947475420623,0.9222865674915327,0.8964819118558853,0.8831451480245814,0.8841742974157384,0.881032017512411,0.8851992289815217,0.8839423170201908,0.8996621521875752,0.9096204378946303,0.908553328075111,0.9051495429986208,0.9135598867935669,0.8975658929768989,0.9053519986165532,0.9127669356233313,0.915917651177406,0.9162888198102822,0.9134417876831064,0.9002020338353951,0.910350121684262,0.9139690158548056,0.9220166266676227,0.9208693781660052,0.9069927326868813,0.9035594228327759,0.9022856395699506,0.8965367435857421,0.8975827642783933,0.9559237248459439,0.9332486956375032,0.9358510938930107,0.9384745812753861,0.934362201536132,0.9559237248459439,0.9563244182564353,0.9502380962423393,0.942224228032511,0.9448898936686223,0.9454930426970463,0.9350328357705334,0.9208314177376429,0.8946007617392625,0.8745660912146915,0.8429028761351223,0.7960934501389774,0.7403253630493191,0.6343651540138935,0.38659743809286806)

all_data <- data.frame(`STORM-seq` = storm_gb,
                       `VASA-seq` = vasa_gb,
                       `Smart-seq-total` = sstotal_gb,
                       `Smart-seq3xpress internal` = ss3_ir_gb,
                       `Smart-seq3xpress 5' UMI` = ss3_5p_gb,
                       `Smart-seq2` = ss2_gb,
                       `tenx_gb` = tenx_gb,
                       percent = 1:100)

all_data <- reshape2::melt(all_data,
                           id.vars = "percent")

ggplot(all_data, aes(x = percent,
                     y = value,
                     group = variable,
                     linetype = variable)) +
  geom_line(aes(color = variable), size = 1.3) +
  xlab("Gene body percentile (5'->3')") +
  ylab("Coverage") +
  scale_linetype_manual(values = c("STORM.seq" = "solid",
                                   "VASA.seq" = "solid",
                                   "Smart.seq.total" = "solid",
                                   "Smart.seq3xpress.internal" = "solid",
                                   "Smart.seq3xpress.5..UMI" = "solid",
                                   "Smart.seq2" = "solid",
                                   "tenx_gb" = "solid")) +
  scale_color_manual(values = c("#63197FFF","#CF5917FF","#8FC2FDFF", "#8CCC17",
                                "#8CCC17", "goldenrod", "black"),
                     labels = c("STORM-seq",
                                "VASA-seq",
                                "Smart-seq-total",
                                "Smart-seq3xpress internal",
                                "Smart-seq3xpress 5' UMI",
                                "Smart-seq2",
                                "10x 3'")) +
  ggtitle("Gene body coverage") +
  guides(linetype = "none") +
  theme_bw(12) +
  theme(
    axis.text = element_text(size = 20),
    axis.title = element_text(size = 20),
    legend.position = "none",
    # legend.title = element_blank(),
    # legend.text = element_text(size = 16),
    plot.title = element_text(hjust = 0.5,
                              size = 22)
  )
